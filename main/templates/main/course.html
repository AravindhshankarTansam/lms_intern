{% extends 'index.html' %}
{% load static %}
{% block title %} {{ course.name }} | eLMS {% endblock title %}
{% block profile %}
{% url 'profile' student.student_id %}
{% endblock %}
{% block user %}
{{student.name}}
{% endblock user %}
{% block courses %}
{% url 'myCourses' %}
{% endblock courses %}
{% block allCourses %}
{% url 'courses' %}
{% endblock allCourses %}
{% block content %}

<style>



   .collapse {
       transition: height 0.35s ease;
   }
   
   .card-body {
       padding: 20px;
   }
   
   .dropdown-button {
       width: 100%;
   }
   
   .card {
       border: none; /* Optional: remove card border */
   }
   .btn-full-width {
   width: 100%;
   }



   @media (max-width: 991.98px) {
   #toast-container {
    top: 50px;
    right: auto;
    left: auto;
    transform: none;
    z-index: 11;
}
   }
   /* Define keyframes for the bling effect */
   @keyframes bling {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Apply the bling effect to the image */
        .bling {
            animation: bling 1s infinite;
        }
   </style>
   
   
<div>



   <div class="top-1 end-0 p-3" id="toast-container" style="z-index: 11;">
      {% if messages %}
         {% for message in messages %}
            <div class="toast show align-items-center text-white bg-danger border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true">
               <div class="d-flex">
                  <div class="toast-body">
                     {{ message }}
                  </div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
               </div>
            </div>
         {% endfor %}
      {% endif %}
   </div>





   <!-- navigation links -->
   <div class="container shadow-sm">
      <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
         <ol class="breadcrumb p-3">
            <li class="breadcrumb-item fw-bold"><a style="color: rgb(10, 10, 48)" href="{% url 'myCourses' %}">My
               Courses</a>
            </li>
            <li class="breadcrumb-item fw-bold animate__animated animate__backInRight"><a class="breadcrumb-item active"
               aria-current="page">{{ course.name }}</a></li>
         </ol>
      </nav>
   </div>
   <!-- navigation links end -->
    <!-- right column -->
    <!-- <div class="col-lg-4 col-md-12">
      <div class="container p-3">
         {% if messages %}
            <div class="alert alert-danger">
               {% for message in messages %}
                  <p>{{ message }}</p>
               {% endfor %}
            </div>
         {% endif %}
      </div>
   </div> -->


   

   <!-- right column end -->
   <div class="container d-flex flex-wrap flex-column">
      <!-- course name starts -->
      <div class="rounded p-3 m-3 shadow d-flex justify-content-between">
         <span></span>
         <h5 class="mt-2 fw-bold">{{course.name}}</h5>
         <div class="dropdown">
            <img class="dropdown-toggle" id="drop" data-bs-toggle="dropdown" aria-expanded="false" src="{% static 'images/icon/dropDown.png' %}"
               alt="Options" height="32">
            <ul class="dropdown-menu">
               <li class="border-bottom">
                  <a class="dropdown-item" href="{% url 'discussion' course.code %}">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-right-dots mx-2" viewBox="0 0 16 16">
                        <path d="M2 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9.586a2 2 0 0 1 1.414.586l2 2V2a1 1 0 0 0-1-1H2zm12-1a2 2 0 0 1 2 2v12.793a.5.5 0 0 1-.854.353l-2.853-2.853a1 1 0 0 0-.707-.293H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h12z"/>
                        <path d="M5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                     </svg>
                     Discussion
                  </a>
               </li>
               <li class="border-bottom">
                  <a class="dropdown-item" href="{% url 'myQuizzes' course.code %}">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text mx-2" viewBox="0 0 16 16">
                        <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                        <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                     </svg>
                     Quiz
                  </a>
               </li>
               <li>
                  <a class="dropdown-item" href="{% url 'downloadCertificte' course.code %}">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download mx-2" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                     </svg>
                                 
                     Certificate
                  </a>
               </li>
            </ul>
         </div>
      </div>
      <!-- course name ends -->
<!-- announcement section starts -->
<div class="dropdown rounded p-3 m-3 shadow border border-top-0 border-bottom-0 border-end-0 border-primary border-5 mb-2">
   <!-- Dropdown Trigger -->
<button class="btn-full-width rounded p-3 shadow border border-top-0 border-end-0 border-bottom-0 d-flex justify-content-between align-items-center" 
        type="button" data-bs-toggle="collapse" data-bs-target="#announcementCollapse" 
        aria-expanded="false" aria-controls="announcementCollapse">

   <!-- Left side: Icon + Text -->
   <div class="fw-bold animate__animated animate__zoomInDown fs-5 text-center" style="color: rgb(10, 10, 48);">
      <img src="{% static 'images/icon/megaphone.png' %}" alt="" 
           style="height:1.5rem; vertical-align: middle;" class="bling">
      <span style="margin-left: 0.6rem;">Instruction</span>
   </div>

   <!-- Right side: Dropdown Icon -->
   <span class="material-symbols-outlined">expand_more</span>
</button>

   <!-- Dropdown Content -->
   <div class="collapse" id="announcementCollapse">
      <div class="card card-body">
         {% for announcement in announcements %}
         <!-- Individual Announcement -->
         <div class="fs-6" id="annDescription{{announcement.id}}">
            {% autoescape off %}{{announcement.description}}{% endautoescape %}
            <div class="d-flex flex-row-reverse border-bottom border-1">
               <div style="color:grey;" class="mb-1">
                  {{announcement.post_date}}
               </div>
            </div>
         </div>
         {% empty %}
         <p class="fs-6 text-center text-muted">No Instruction has been posted</p>
         {% endfor %}
      </div>
   </div>
</div>
<!-- announcement section ends -->


 <!-- course material section starts -->
 <div class="dropdown rounded p-3 m-3 shadow border border-top-0 border-bottom-0 border-warning border-end-0 border-5 mb-2">
   <!-- Dropdown Trigger -->
   <button class="btn-full-width rounded p-3 shadow border border-top-0 border-end-0 border-bottom-0 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#materialCollapse" aria-expanded="false" aria-controls="materialCollapse">
      <div class="fw-bold animate__animated animate__zoomInDown fs-5 text-center border-bottom border-1 mb-2 py-2" style="color: rgb(10, 10, 48);">
         <img src="{% static 'images/icon/folder.png' %}" alt="" style="height:1.5rem; vertical-align: text-top">
         <span style="margin-right: 0.6rem;"></span>Course Material
      </div>

         <!-- Right side: Dropdown Icon -->
   <span class="material-symbols-outlined">expand_more</span>
   </button>
   <!-- Dropdown Content -->
   <div class="collapse" id="materialCollapse">
      <div class="card card-body">
         {% for material in materials %}
         <!-- Individual Material -->
         <div id="descriptionContainer">
            {% autoescape off %}
            {{ material.description }}
            {% endautoescape %}
         </div>
         <div class="d-flex justify-content-between text-break">
            {% if material.file %}
            <a class="fw-bold" href="#" onclick="openFileModal(event, '{{ material.file.url }}')">
               <span style="color:#9400d3" id="materialName">{{ material.file.name }}</span>
            </a><br>
            {% endif %}
            <!-- <div class="text-muted">
               {{ material.post_date }}
            </div> -->
         </div>
         {% empty %}
         <p class="text-center text-muted fs-6">Course materials not available</p>
         {% endfor %}
      </div>
   </div>
</div>
<!-- course material section ends -->

 <!-- quiz section starts -->
 <div class="dropdown rounded p-3 m-3 shadow border border-top-0 border-bottom-0 border-end-0 border-primary border-5 mb-2">
   <!-- Dropdown Trigger -->
   <button class="btn-full-width rounded p-3 shadow border border-top-0 border-end-0 border-bottom-0 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#quizCollapse" aria-expanded="false" aria-controls="quizCollapse">
      <div class="fw-bold animate__animated animate__zoomInDown fs-5 text-center border-bottom border-1 mb-2 py-2" style="color: rgb(10, 10, 48);">
         <img src="{% static 'images/icon/quiz-icon.png' %}" alt="" style="height:1.5rem; vertical-align: text-top" class="">
         <span style="margin-right: 0.6rem;"></span>Quiz
      </div>

         <!-- Right side: Dropdown Icon -->
   <span class="material-symbols-outlined">expand_more</span>
   </button>
   <!-- Dropdown Content -->
   <div id="quizCollapse" class="collapse">
      <div class="card-body">
         <ul class="list-unstyled">
            <!-- Loop through quizzes and display as list items -->
            {% for quiz in quizzes %}
            <a class="fw-bold" href="{% url 'myQuizzes' course.code %}">{{ quiz.title }}</a>
            <div class="d-flex justify-content-between">
               <p style="font-size:15px">Due Date: {{ quiz.ends }}</p>
            </div>
            {% empty %}
               <p class="fs-6 text-center text-muted">No quiz given yet</p>
            {% endfor %}
         </ul>
      </div>
   </div>
</div>
<!-- quiz section ends -->





      <!-- assignment section starts -->
<div class="dropdown rounded p-3 m-3 shadow border border-top-0 border-bottom-0 border-end-0 border-danger border-5 mb-2">
   <!-- Dropdown Trigger -->
   <button class="btn-full-width rounded p-3 shadow border border-top-0 border-end-0 border-bottom-0 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#assignmentCollapse" aria-expanded="false" aria-controls="assignmentCollapse">
      <div class="fw-bold animate__animated animate__zoomInDown fs-5 text-center border-bottom border-1 mb-2 py-2" style="color: rgb(10, 10, 48);">
         <img src="{% static 'images/icon/open-book.png' %}" alt="" style="height:1.5rem; vertical-align: text-top" class="bling">
         <span style="margin-right: 0.6rem;"></span>Project
      </div>

         <!-- Right side: Dropdown Icon -->
   <span class="material-symbols-outlined">expand_more</span>
   </button>
   <!-- Dropdown Content -->
   <div class="collapse" id="assignmentCollapse">
      <div class="card card-body">
         {% for assignment in assignments %}
         <!-- Individual Assignment -->
         <a class="fw-bold" href="{% url 'assignmentPage' course.code assignment.id %}">{{ assignment.title }}</a>
         <div class="d-flex justify-content-between">
            <p style="font-size:15px">Due Date: {{ assignment.due_date }}</p>
         </div>
         {% empty %}
         <p class="fs-6 text-center text-muted">No projects given yet</p>
         {% endfor %}
      </div>
      <!-- {% if assignments %}
      <div class="text-center fs-6 text-muted d-flex flex-column border-top border-1 mt-2">
         <span class="mt-2">Showing {{ assignments.count }} of {{ course.assignment_set.count }}
            {% if assignments.count == 1 %}assignment {% else %}assignments{% endif %}
         </span>
         <a class="fs-6" href="{% url 'student-assignments' course.code %}">Show all</a>
      </div>
      {% endif %} -->
   </div>
</div>
<!-- assignment section ends -->

<!-- Include Bootstrap CSS and JS if not already included -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9B6mE8jJFT9oG4KQOlfQ9t3EhtA1pFkm6mIB9IoV8izsE+hmw5t" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js" integrity="sha384-GLhlT+pi3WkGyoQy2K6bsDT3vF4pa9erI3DBP7EQQYkUksxT7DkW2Xc1VWkX2MBk" crossorigin="anonymous"></script>

     

      <!-- download certificate section starts -->
      <div class="dropdown rounded p-3 m-3 shadow border border-top-0 border-bottom-0 border-bottom-12 border-end-0 border-primary border-5 mb-2">
         <!-- Dropdown Trigger -->
         <button class="btn-full-width rounded p-3 shadow border border-top-0 border-end-0 border-bottom-0 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#certificateCollapse" aria-expanded="false" aria-controls="certificateCollapse">
            <div class="fw-bold animate__animated animate__zoomInDown fs-5 text-center border-bottom border-1 mb-2 py-2" style="color: rgb(10, 10, 48);">
               <img src="{% static 'images/icon/download_icon.png' %}" alt="" style="height:1.5rem; vertical-align: text-top" class="">
               <span style="margin-right: 0.6rem;"></span> Download Certificate
            </div>

               <!-- Right side: Dropdown Icon -->
   <span class="material-symbols-outlined">expand_more</span>
         </button>
         <!-- Dropdown Content -->
         <div id="certificateCollapse" class="collapse">
            <div class="card-body text-center">
               <!-- Display download certificate link or content here -->
               <a href="{% url 'downloadCertificte' course.code %}" class="btn btn-primary">Download Certificate</a>
            </div>
         </div>
      </div>
      <!-- download certificate section ends -->
   </div>
</div>
<!-- Modal HTML -->
<div class="modal fade" id="fileModal" tabindex="-1" aria-labelledby="fileModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-dialog-centered modal-lg">
       <div class="modal-content">
           <div class="modal-header">
               <h5 class="modal-title" id="fileModalLabel">File Preview</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
           </div>
           <div class="modal-body">
               <div class="iframe-container">
                   <iframe id="filePreview"></iframe>
                   <div class="iframe-overlay"></div>
               </div>
               <div id="filePreviewWarning" style="display: none; color: red;">This file cannot be displayed in the browser.</div>
           </div>
           <div class="modal-footer">
               <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
           </div>
       </div>
   </div>
</div>

<style>
    iframe {
        width: 100%;
        height: 100vh;
        border: 0;
    }
</style>
<!-- <script>
   var materialName = document.getElementById("materialName").innerHTML;
   var materialName = materialName.replace("materials/", "");
   document.getElementById("materialName").innerHTML = materialName;
</script> -->

<script>
   document.addEventListener('DOMContentLoaded', function() {
      var toastElements = document.querySelectorAll('.toast');
      toastElements.forEach(function(toastElement) {
         var toast = new bootstrap.Toast(toastElement, { autohide: true, delay: 3000 });
         toast.show();
      });
   });
</script>




<script>
   document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded and parsed'); // Debugging line
    document.addEventListener('click', function(event) {
        console.log('Document click detected'); // Debugging line
        if (event.target.tagName === 'A' && event.target.classList.contains('fr-file')) {
            event.preventDefault();
            console.log('Link clicked:', event.target.href); // Debugging line
            openFileModal(event.target.href);
        }
    });

    function openFileModal(fileUrl) {
        console.log('Opening file modal for:', fileUrl); // Debugging line
        var filePreview = document.getElementById('filePreview');
        var filePreviewWarning = document.getElementById('filePreviewWarning');

        var extension = fileUrl.split('.').pop().toLowerCase();
        var displayableExtensions = ['pdf', 'jpg', 'jpeg', 'png', 'gif'];

        if (displayableExtensions.includes(extension)) {
            if (extension === 'pdf') {
                filePreview.src = fileUrl + '#toolbar=0';
            } else {
                filePreview.src = fileUrl;
            }
            filePreview.style.display = 'block';
            filePreviewWarning.style.display = 'none';
        } else {
            filePreview.style.display = 'none';
            filePreviewWarning.style.display = 'block';
            filePreviewWarning.innerText = 'This file cannot be displayed in the browser.';
        }

        var fileModal = new bootstrap.Modal(document.getElementById('fileModal'));
        fileModal.show();
    }
});
document.addEventListener('DOMContentLoaded', function() {
    // Handle dropdown toggle
    const triggers = document.querySelectorAll('.dropdown-trigger');
    const contents = document.querySelectorAll('.dropdown-content');

    triggers.forEach(trigger => {
        trigger.addEventListener('click', function() {
            const content = this.nextElementSibling;
            // Hide all dropdowns except the one clicked
            contents.forEach(c => {
                if (c !== content) {
                    c.classList.remove('show');
                }
            });
            // Toggle the clicked dropdown
            content.classList.toggle('show');
        });
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.classList.contains('dropdown-trigger')) {
            contents.forEach(content => {
                content.classList.remove('show');
            });
        }
    });
});
</script>



{% endblock %}